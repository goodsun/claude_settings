# 月次ITAGタスクレポート生成

指定された年月のITAG完了タスクを取得し、Google Docsに書き込むためのデータを生成します。

## 引数
- $ARGUMENTS: 年月（例: "2025 11" または "2025/11"）。省略時は前月を使用。

## 実行手順

1. 引数から年月を解析（省略時は前月）
2. Asana MCPで以下の条件でタスクを検索:
   - ワークスペース: leveragesグループ (15797530005296)
   - チーム: アグリゲートメディア事業部 (1199545333560465)
   - メディア: ITAGを含むもの（「ITAG」「ITAG & MDAG」など）
   - 完了日: 指定月の1日〜末日
   - opt_fields: name,assignee,assignee.name,completed_at,custom_fields,custom_fields.name,custom_fields.display_value
3. 取得したタスクを担当者別にグルーピング
4. 各担当者内で完了日の昇順にソート
5. 以下のマークダウン形式でレポートを生成:

```
# {年}年{月}月 ITAG完了タスク（担当者別）

## {担当者名}（{件数}件）

| AG | タスク名 | 工数レベル | 完了日 |
|----|----------|-----------|--------|
| {AG} | {タスク名} | {工数} | {MM/DD} |

...

## サマリー

| 担当者 | 完了タスク数 |
|--------|-------------|
| {担当者名} | {件数}件 |
| **合計** | **{総件数}件** |
```

6. 生成したマークダウンをコードブロック（```markdown ... ```）で囲んで出力する（ユーザーがそのままコピーできるように）

## 注意事項
- custom_fieldsから「メディア」フィールドの値を確認し、「ITAG」を含むもののみ抽出
- 工数レベルはcustom_fieldsの「工数レベル」から取得（nullの場合は「-」）
- AGはcustom_fieldsの「AG」から取得（nullの場合は「-」）
- 担当者なしのタスクは「担当者なし」としてグルーピング
- 担当者は完了タスク数の多い順にソート

## 件数計算の手順（重要）

レポート生成時は必ず以下の手順で件数を計算すること：

1. **ITAGタスクの抽出**: Asanaから取得したタスクのうち、custom_fieldsの「メディア」フィールドが「ITAG」「ITAG & MDAG」など「ITAG」を含むもののみをフィルタリングする
2. **担当者別にグルーピング**: フィルタリング後のタスクを担当者ごとにグループ化する
3. **件数のカウント**: 各担当者のグループに含まれるタスク数を**実際にカウント**する
4. **整合性の確認**: 以下の3つの数値が完全に一致することを確認する
   - 見出し `## {担当者名}（{件数}件）` の件数
   - テーブルの行数（ヘッダー行を除く）
   - サマリーテーブルの件数
5. **合計の計算**: サマリーの合計は、各担当者の件数を**実際に足し合わせた値**にする

**よくあるミス**:
- フィルタリング前の件数を使ってしまう
- テーブル行を数えずに推定で件数を書いてしまう
- 見出しとサマリーで異なる件数を書いてしまう
